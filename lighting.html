<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webcam Movement Detection</title>
    <style>
        #output {
            font-family: Arial, sans-serif;
            margin-top: 10px;
        }
    </style>
</head>

<body style="background-color:black;color:white;transform:scale(-1,1)">
    <div id="connectionInfo">Connecting...</div>
    <video id="webcam" width="640" height="480" autoplay muted></video>
    <canvas id="canvas" width="640" height="480" style="border:1px solid;"></canvas>
    <div id="output"></div>
    <!-- Sliders for adjustments -->
    <div style="transform:scale(-1,1)">
        Pie Radius: <input type="range" min="10" max="240" value="200" id="pieSize"><br>
        Circle Diameter: <input type="range" min="100" max="620" value="400" id="circleDiameter"><br>
        Number of Regions: <input type="range" min="3" max="48" value="16" id="numRegions"><br>
        Movement Threshold: <input type="range" min="0" max="100" value="50" id="movementThreshold"><br>
    </div>

    <script>
        let webSocket;

        function connectWebSocket() {
            webSocket = new WebSocket('ws://192.168.0.99:81');
            // Update the connectionInfo div when the WebSocket connection opens or closes
            webSocket.addEventListener('open', function () {
                document.getElementById('connectionInfo').innerHTML = 'Connected to ws://192.168.0.99:81';
            });
            webSocket.addEventListener('close', function () {
                document.getElementById('connectionInfo').innerHTML = 'Disconnected';
                setTimeout(connectWebSocket, 3000); // reconnect after 3 seconds
            });
        }

        connectWebSocket();

        let video = document.getElementById('webcam');
        let canvas = document.getElementById('canvas');
        let context = canvas.getContext('2d');
        let output = document.getElementById('output');

        let previousImageData = null;

        let pieSizeInput = document.getElementById('pieSize');
        let circleDiameterInput = document.getElementById('circleDiameter');
        let numRegionsInput = document.getElementById('numRegions');
        let movementThresholdInput = document.getElementById('movementThreshold');

        let regions = [];
        let lastLoggedOpacities = [];

        function computeRegions() {
            regions = [];
            let numRegions = parseInt(numRegionsInput.value);
            let pieSize = parseInt(pieSizeInput.value);
            let circleDiameter = parseInt(circleDiameterInput.value);
            let centerX = canvas.width / 2;
            let centerY = canvas.height / 2;

            for (let i = 0; i < numRegions; i++) {
                let startAngle = (i / numRegions) * (2 * Math.PI);
                let endAngle = ((i + 1) / numRegions) * (2 * Math.PI);
                regions.push({ centerX, centerY, startAngle, endAngle, radius: pieSize });
            }
        }

        pieSizeInput.addEventListener('input', computeRegions);
        circleDiameterInput.addEventListener('input', computeRegions);
        numRegionsInput.addEventListener('input', computeRegions);

        // Start the webcam and get permission only once
        navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
            video.srcObject = stream;
        });

        // ... Rest of your script remains unchanged ...
    </script>
</body>

</html>
